<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tallinna pimedamaid päevad - Detsember 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            font-size: 22pt; /* Kasutaja soovitud suurus */
            margin-bottom: 10px;
            color: #2c3e50;
        }
        p.subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .split-chart-container {
            position: relative;
            width: 100%;
            margin-bottom: 30px;
            border: 1px solid #d0dce6; 
            border-radius: 4px;
            overflow: hidden;
            background-color: #fff;
        }

        .chart-part {
            position: relative;
            width: 100%;
        }

        /* Ülemine graafik (Hommik) */
        #sunriseChartWrapper {
            height: 200px;
        }

        /* Vaheala (Keskpäev) */
        .chart-gap {
            height: 40px;
            width: 100%;
            background: linear-gradient(to bottom, rgba(255, 206, 86, 0.3), rgba(255, 206, 86, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            color: #947c2d;
            font-size: 18px; /* Ühtlustatud suurus, kuigi CSS-is px */
            font-weight: bold;
            letter-spacing: 1px;
            border-top: 1px dashed rgba(0,0,0,0.1);
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }

        /* Alumine graafik (Õhtu) */
        #sunsetChartWrapper {
            height: 200px;
        }

        .chart-wrapper-small {
            position: relative;
            height: 150px;
            width: 100%;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Tallinna pimedamaid päevad</h1>
    <p class="subtitle">14. – 31. detsember 2025. Sinine = pime aeg; kollane = valge aeg.</p>

    <div class="split-chart-container">
        <!-- 1. Ülemine osa: Hommik -->
        <div id="sunriseChartWrapper" class="chart-part">
            <canvas id="sunriseChart"></canvas>
        </div>

        <!-- Vahekoht: Valge aeg -->
        <div class="chart-gap">
            Päev (10.00 - 15.00)
        </div>

        <!-- 2. Alumine osa: Õhtu -->
        <div id="sunsetChartWrapper" class="chart-part">
            <canvas id="sunsetChart"></canvas>
        </div>
    </div>
    
    <!-- Graafik 3: Päeva pikkus -->
    <div class="chart-wrapper-small">
        <canvas id="dayLengthChart"></canvas>
    </div>
</div>

<script>
    // --- SEADISTUSED ---
    // Määrame globaalse fondi suuruse
    Chart.defaults.font.size = 18;

    // --- ANDMED ---
    const labels = [
        '14.12', '15.12', '16.12', '17.12', '18.12', '19.12', '20.12', 
        '21.12', 
        '22.12', '23.12', '24.12', '25.12', '26.12', '27.12', '28.12', '29.12', '30.12', '31.12'
    ];
    
    const sunriseTimes = ['09:10', '09:12', '09:13', '09:14', '09:15', '09:16', '09:17', '09:17', '09:18', '09:18', '09:19', '09:19', '09:19', '09:20', '09:20', '09:19', '09:19', '09:18'];
    const sunsetTimes = ['15:18', '15:18', '15:18', '15:18', '15:19', '15:19', '15:20', '15:20', '15:21', '15:22', '15:23', '15:24', '15:25', '15:26', '15:28', '15:29', '15:31', '15:33'];
    
    // Arvutame täpsed minutid kellaaegade vahest
    function calculateDuration(start, end) {
        const [h1, m1] = start.split(':').map(Number);
        const [h2, m2] = end.split(':').map(Number);
        return (h2 * 60 + m2) - (h1 * 60 + m1);
    }
    
    const dayLengths = sunriseTimes.map((start, i) => calculateDuration(start, sunsetTimes[i]));
    
    function timeToDecimal(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours + minutes / 60;
    }

    function decimalToTime(decimal) {
        const hours = Math.floor(decimal);
        const minutes = Math.round((decimal - hours) * 60);
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }

    const sunriseData = sunriseTimes.map(timeToDecimal);
    const sunsetData = sunsetTimes.map(timeToDecimal);

    // Värvid
    const colors = {
        line: '#2c3e50',
        dayLight: 'rgba(255, 206, 86, 0.3)', // Kollane
        darkness: '#dbe4eb', // Sinine
        solstice: '#e74c3c'
    };

    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                filter: function(tooltipItem) {
                    return tooltipItem.datasetIndex === 0; 
                },
                callbacks: {
                    label: function(context) {
                        if (context.dataset.label === 'Päeva pikkus') {
                            const hours = Math.floor(context.raw / 60);
                            const mins = context.raw % 60;
                            return `Pikkus: ${hours}h ${mins}min (${context.raw} min)`;
                        }
                        let label = context.dataset.label + ': ' + decimalToTime(context.raw);
                        if (context.dataIndex === 7) label += ' (Pööripäev)';
                        return label;
                    }
                }
            }
        },
        scales: {
            x: {
                grid: { color: 'rgba(0,0,0,0.05)' },
                ticks: { display: false }
            }
        }
    };

    const pointColors = (ctx) => ctx.dataIndex === 7 ? colors.solstice : colors.line;
    const pointRadii = (ctx) => ctx.dataIndex === 7 ? 6 : 4;

    // --- 1. Hommik (Päikesetõus) ---
    new Chart(document.getElementById('sunriseChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    // VALGE ALA (Päev) - fill 'start' täidab alla (sest reverse Y-teljel start on "põhi" ehk suurem number)
                    label: 'Valgus',
                    data: sunriseData,
                    borderColor: colors.line,
                    backgroundColor: colors.dayLight, 
                    fill: 'start',
                    tension: 0.4,
                    pointBackgroundColor: pointColors,
                    pointRadius: pointRadii,
                    zIndex: 2
                },
                {
                    // PIME ALA (Öö) - fill 'end' täidab üles (sest reverse Y-teljel end on "lagi" ehk väiksem number)
                    label: 'Pimedus',
                    data: sunriseData,
                    borderColor: 'transparent',
                    backgroundColor: colors.darkness, 
                    fill: 'end',
                    tension: 0.4,
                    pointRadius: 0, 
                    hitRadius: 0, 
                    zIndex: 1
                }
            ]
        },
        options: {
            ...commonOptions,
            layout: { padding: { bottom: 0 } },
            scales: {
                y: {
                    reverse: true,
                    min: 9.14,
                    max: 9.36,
                    ticks: {
                        callback: function(value) { return decimalToTime(value); },
                        stepSize: 2/60
                    },
                    title: { display: true, text: 'Hommik' }
                },
                x: {
                    grid: { display: false },
                    ticks: { display: false }
                }
            },
            plugins: {
                ...commonOptions.plugins,
                title: { display: true, text: 'Hommikud lähevad pimedamaks (sinine ala suureneb)' }
            }
        }
    });

    // --- 2. Õhtu (Päikeseloojang) ---
    new Chart(document.getElementById('sunsetChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    // PIME ALA (Öö) - fill 'start' täidab alla
                    label: 'Pimedus',
                    data: sunsetData,
                    borderColor: colors.line,
                    backgroundColor: colors.darkness, 
                    fill: 'start',
                    tension: 0.4,
                    pointBackgroundColor: pointColors,
                    pointRadius: pointRadii,
                    zIndex: 2
                },
                {
                    // VALGE ALA (Päev) - fill 'end' täidab üles
                    label: 'Valgus',
                    data: sunsetData,
                    borderColor: 'transparent',
                    backgroundColor: colors.dayLight, 
                    fill: 'end',
                    tension: 0.4,
                    pointRadius: 0,
                    hitRadius: 0,
                    zIndex: 1
                }
            ]
        },
        options: {
            ...commonOptions,
            layout: { padding: { top: 0 } },
            scales: {
                y: {
                    reverse: true,
                    min: 15.28,
                    max: 15.6,
                    ticks: {
                        callback: function(value) { return decimalToTime(value); },
                        stepSize: 3/60
                    },
                    title: { display: true, text: 'Õhtu' }
                },
                x: {
                    grid: { display: false },
                    ticks: { 
                        display: true,
                        maxRotation: 45,
                        minRotation: 45
                    } 
                }
            },
            plugins: {
                ...commonOptions.plugins,
                title: { display: true, text: 'Õhtud lähevad valgemaks (kollane ala suureneb)' }
            }
        }
    });

    // --- 3. Päeva pikkus ---
    new Chart(document.getElementById('dayLengthChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Päeva pikkus',
                data: dayLengths,
                borderColor: '#27ae60',
                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                fill: true,
                tension: 0.4,
                pointBackgroundColor: (ctx) => ctx.dataIndex === 7 ? colors.solstice : '#27ae60',
                pointRadius: pointRadii
            }]
        },
        options: {
            ...commonOptions,
            plugins: {
                ...commonOptions.plugins,
                title: { display: true, text: 'Päeva kogupikkus minutites' }
            },
            scales: {
                y: {
                    title: { display: true, text: 'Minutid' }
                },
                x: {
                    ticks: { display: true, maxRotation: 45, minRotation: 45 }
                }
            }
        }
    });
</script>

</body>
</html>
